# 6-3-B树和B+树

## 1-B树

> 多路平衡查找树，B树中所有结点的孩子结点数的最大值称为B树的阶。

![](../../.gitbook/assets/image%20%28284%29.png)

一棵m阶B树或为**空树，**或为满足如下特性的m叉树:

1. 树中每个结点**至多有m棵子树**\(即至多含有m-1个关键字\)
2. 若根结点不是终端结点，**则至少有两棵子树**
3. 除根结点外的所有非叶结点至少有 「m/2 棵子树\(即「 m/2 -1 个关键字\) 
4. 所有的**叶结点都出现在同一层次上，并不带任何信息**
5. 非叶结点的结构:

![](../../.gitbook/assets/image%20%28288%29.png)

![](../../.gitbook/assets/image%20%28215%29.png)

！！n个关键字，阶数为m，高度为h的B树，h计算。

### 查找

### 插入

* 定位
  * 查找插入该关键字的位置，即最底层中的某个非叶子结点 \(规定一定是插入在最底层的某个非叶子结点内\)
* 插入

  * 若插入后，不破会m阶B树的定义，即插入后结点关键字个数 在属于区间 \[ m/2 -1, m-1\]，则直接插入;

* 分裂: 插入后的结点中间位置\( m/2 \)关键字并入父结点中， 中间结点左侧结点留在原先的结点中，右侧结点放入新的节点中， 若并入父节点后，父结点关键字数量超出范围，继续想上分裂，直到符合要求为止。

### 删除

![](../../.gitbook/assets/image%20%2840%29.png)

#### 终端结点的删除

* 直接删除
  * 若被删除关键字所在结点关键字个数&gt; m/2 -1，表明删除后仍满足B树 定义，直接删除
* 兄弟够借
* * 若被删除关键字所在结点关键字总数= m/2 -1，且与此结点邻近的兄弟结点的关键字个数≥ m/2 ，则需要从兄弟结点借一个关键字，此过程需 要调整该结点、双亲结点和兄弟结点的关键字
* 兄弟不够借
* * 若被删除关键字所在结点关键字总数= m/2 -1，且与此结点邻近的兄弟 结点的关键字个数= m/2 -1，则删除关键字，并与一个不够借的兄弟结 点和双亲结点中两兄弟子树中间的关键字合并。 合并后若双亲结点因减少一个结点导致不符合定义，则继续执行2、3步骤。

#### 非终端结点的删除

* 若小于k的子树中关键字个数&gt; m/2 -1,则找出k的前驱值k'，并 用k’来取代k，再递归地删除k'即可。
* 若大于k的子树中关键字个数&gt; m/2 -1,则找出k的后继值k'，并 用k’来取代k，再递归地删除k'即可。
* 若前后两子树关键字个数均为 m/2 -1,则直接两个子结点合并， 然后删除k即可。

## 2-B+树

一棵m阶B+树满足如下特性:

* 每个分支结点最多有m棵子树\(子结点\)
* 若根结点不是终端结点，则至少有两棵子树
* 除根结点外的所有非叶结点至少有「m/2 棵子树，**子树和关键字个数相等**
* **所有叶结点包含全部关键字及指向相应记录的指针**，叶结点中将关键字按 大小顺序排列，并且相邻结点按大小顺序连接起来
* 所有**分支结点\(可视为索引的索引\)中仅包含他的各个子结点\(**下一级索引 块\)中关键字的最大值及指向其子结点的指针
* 
![](../../.gitbook/assets/image%20%283%29.png)

## 3-B+树 vs B树

1. 在B+树中，具有n个关键字的结点值含有n棵子树，即每个关键字对应 一棵子树;
2. 在B树中，具有n个关键字的结点含有n+1棵子树 2\)在B+树中，叶结点包含信息，所有非叶结点仅起索引作用，非叶结点中的每个索引项只含有对应子树的最大关键字和指向该子树关键字的指针，不 含有该关键字对应记录的存储地址
3. 在B+树中，叶结点包含全部关键字，即在非叶结点中出现的关键字也会 出现在叶结点中
4. 在B树中，叶结点包含的关键字和其他结点包含的关键字是不重复的

在B+树中有两种查找方式。  
在B+树中查找时，无论查找成功还是失败一定是查找到叶结 点当中的值为止

